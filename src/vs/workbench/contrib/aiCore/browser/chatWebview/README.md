# AI Chat Webview - Kiro é£æ ¼ UI

## è®¾è®¡æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Webview + React** çš„ Chat UI å®ç°ï¼Œç”¨äºæ›¿æ¢ VSCode åŸç”Ÿ Chat APIï¼Œè§£å†³æµå¼è¾“å‡ºæ¸²æŸ“é—®é¢˜ã€‚è®¾è®¡å‚è€ƒ Kiro IDE çš„äº¤äº’é£æ ¼ã€‚

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VSCode Extension Host                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ChatWebviewControllerâ”‚â”€â”€â”€â–¶â”‚ GLMChatService          â”‚   â”‚
â”‚  â”‚ (Webview Host)       â”‚    â”‚ AgentToolService        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ ChatModeService         â”‚   â”‚
â”‚             â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚ postMessage (åŒå‘é€šä¿¡)                        â”‚
â”‚             â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Webview (React App)                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  ChatApp                                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ ChatHeader (æ¨¡å¼åˆ‡æ¢: Vibe/Spec)        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ MessageList (æ¶ˆæ¯åˆ—è¡¨ï¼Œè‡ªåŠ¨æ»šåŠ¨)         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Message                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”œâ”€â”€ ThinkingIndicator (æ€è€ƒåŠ¨ç”»)   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”œâ”€â”€ ToolCallCard (å·¥å…·è°ƒç”¨å¡ç‰‡)    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”œâ”€â”€ MarkdownContent (Markdownæ¸²æŸ“) â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â””â”€â”€ CodeBlock (ä»£ç å—+æ“ä½œæŒ‰é’®)    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€ ChatInput (è¾“å…¥æ¡†+é™„ä»¶+å‘é€)            â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒä¼˜åŠ¿

### 1. å®Œå…¨è‡ªæ§çš„æµå¼æ¸²æŸ“
- ä¸ä¾èµ– VSCode Chat API çš„ `markdownContent` åˆå¹¶æœºåˆ¶
- React çŠ¶æ€é©±åŠ¨ï¼Œæµå¼å†…å®¹å®æ—¶è¿½åŠ æ˜¾ç¤º
- æ‰“å­—æœºæ•ˆæœï¼Œå¸¦é—ªçƒå…‰æ ‡

### 2. çµæ´»çš„ UI å®šåˆ¶
- å¯è‡ªå®šä¹‰ä»»ä½• UI å…ƒç´ 
- æ”¯æŒæ·±è‰²/æµ…è‰²/é«˜å¯¹æ¯”åº¦ä¸»é¢˜
- å“åº”å¼å¸ƒå±€

### 3. ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½
- å·¥å…·è°ƒç”¨å¯æŠ˜å å¡ç‰‡ï¼Œæ˜¾ç¤ºå‚æ•°å’Œç»“æœ
- ä»£ç å—å¸¦å¤åˆ¶/åº”ç”¨æŒ‰é’®
- æ–‡ä»¶é™„ä»¶æ”¯æŒ
- æ¨¡å¼åˆ‡æ¢ (Vibe/Spec)

## æ¶ˆæ¯é€šä¿¡åè®®

### Extension â†’ Webview

```typescript
type ExtensionToWebviewMessage =
  | { type: 'init'; payload: { mode, sessionId, history, theme } }
  | { type: 'streamStart'; payload: { messageId } }
  | { type: 'streamContent'; payload: { messageId, content, fullContent } }
  | { type: 'streamThinking'; payload: { messageId, thinking } }
  | { type: 'streamComplete'; payload: { messageId } }
  | { type: 'toolCallStart'; payload: { messageId, toolCall } }
  | { type: 'toolCallComplete'; payload: { messageId, toolCallId, status, result?, error? } }
  | { type: 'error'; payload: { messageId?, error } }
  | { type: 'modeChanged'; payload: { mode } }
  | { type: 'themeChanged'; payload: { theme } };
```

### Webview â†’ Extension

```typescript
type WebviewToExtensionMessage =
  | { type: 'ready' }
  | { type: 'sendMessage'; payload: { content, attachments? } }
  | { type: 'cancelRequest' }
  | { type: 'changeMode'; payload: { mode } }
  | { type: 'attachFile'; payload: { action } }
  | { type: 'applyCode'; payload: { code, filename?, language } }
  | { type: 'copyCode'; payload: { code } }
  | { type: 'clearHistory' }
  | { type: 'retryMessage'; payload: { messageId } };
```

## Kiro é£æ ¼ UI è®¾è®¡è¦ç‚¹

1. **ç®€æ´çš„ä¾§è¾¹æ å¸ƒå±€** - Chat Panel åœ¨ä¾§è¾¹æ 
2. **æ¨¡å¼åˆ‡æ¢** - âš¡ Vibe Mode / ğŸ“‹ Spec Mode åˆ‡æ¢æŒ‰é’®
3. **æµå¼å†…å®¹æ˜¾ç¤º** - æ‰“å­—æœºæ•ˆæœï¼Œå¸¦é—ªçƒå…‰æ ‡
4. **å·¥å…·è°ƒç”¨å¡ç‰‡** - å¯å±•å¼€ï¼Œæ˜¾ç¤ºå·¥å…·åç§°ã€çŠ¶æ€ã€å‚æ•°ã€ç»“æœ
5. **ä»£ç å—** - è¯­æ³•é«˜äº® + å¤åˆ¶/åº”ç”¨æŒ‰é’®
6. **ä¸Šä¸‹æ–‡å¼•ç”¨** - æ”¯æŒ #File, #Folder æ ‡ç­¾
7. **æ·±è‰²/æµ…è‰²/é«˜å¯¹æ¯”åº¦ä¸»é¢˜** - è·Ÿéš VSCode ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢
8. **æ€è€ƒæŒ‡ç¤ºå™¨** - ä¸‰ä¸ªè·³åŠ¨çš„ç‚¹ + æ€è€ƒå†…å®¹

## æ–‡ä»¶ç»“æ„

```
chatWebview/
â”œâ”€â”€ README.md                     # æœ¬æ–‡æ¡£
â”œâ”€â”€ protocol.ts                   # æ¶ˆæ¯åè®®å®šä¹‰
â”œâ”€â”€ chatWebviewPane.ts            # Webview æ§åˆ¶å™¨ (å®¿ä¸»)
â”œâ”€â”€ chatWebview.contribution.ts   # æ³¨å†Œè§†å›¾
â””â”€â”€ media/
    â”œâ”€â”€ index.html                # HTML å…¥å£
    â”œâ”€â”€ main.tsx                  # React å…¥å£
    â”œâ”€â”€ types.ts                  # TypeScript ç±»å‹
    â”œâ”€â”€ useChat.ts                # Chat çŠ¶æ€ç®¡ç† Hook
    â”œâ”€â”€ package.json              # ä¾èµ–é…ç½®
    â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
    â””â”€â”€ components/
        â”œâ”€â”€ index.ts              # ç»„ä»¶å¯¼å‡º
        â”œâ”€â”€ styles.css            # æ ·å¼ (Kiro é£æ ¼)
        â”œâ”€â”€ ChatApp.tsx           # ä¸»åº”ç”¨ç»„ä»¶
        â”œâ”€â”€ ChatHeader.tsx        # å¤´éƒ¨ (æ¨¡å¼åˆ‡æ¢)
        â”œâ”€â”€ MessageList.tsx       # æ¶ˆæ¯åˆ—è¡¨
        â”œâ”€â”€ Message.tsx           # å•æ¡æ¶ˆæ¯
        â”œâ”€â”€ ThinkingIndicator.tsx # æ€è€ƒæŒ‡ç¤ºå™¨
        â”œâ”€â”€ ToolCallCard.tsx      # å·¥å…·è°ƒç”¨å¡ç‰‡
        â”œâ”€â”€ MarkdownContent.tsx   # Markdown æ¸²æŸ“
        â”œâ”€â”€ CodeBlock.tsx         # ä»£ç å—
        â””â”€â”€ ChatInput.tsx         # è¾“å…¥æ¡†
```

## å¿«é€Ÿå¼€å§‹

### è‡ªåŠ¨æ„å»ºï¼ˆæ¨èï¼‰

æ„å»ºå·²é›†æˆåˆ°ä¸»é¡¹ç›®çš„ watch æµç¨‹ä¸­ï¼Œè¿è¡Œ `npm run watch` æ—¶ä¼šè‡ªåŠ¨æ„å»º Chat Webviewï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
npm run watch
```

ç»ˆç«¯ä¼šæ˜¾ç¤º `[chat-webview]` å‰ç¼€çš„æ„å»ºæ—¥å¿—ã€‚

### æ‰‹åŠ¨æ„å»º

å¦‚æœéœ€è¦å•ç‹¬æ„å»ºï¼š

```bash
# å•æ¬¡æ„å»º
npm run compile-chat-webview

# Watch æ¨¡å¼
npm run watch-chat-webview
```

### ä¾èµ–è¯´æ˜

- **æ— éœ€å•ç‹¬å®‰è£…ä¾èµ–** - ä½¿ç”¨ä¸»é¡¹ç›®çš„ `esbuild` å’Œ `react`
- é¦–æ¬¡ä½¿ç”¨å‰è¯·ç¡®ä¿å·²åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œè¿‡ `npm install`

## åç»­æ”¹è¿›

- [ ] æ·»åŠ  Markdown è¯­æ³•é«˜äº® (ä½¿ç”¨ marked + highlight.js)
- [ ] æ·»åŠ ä»£ç å·®å¼‚å¯¹æ¯”è§†å›¾
- [ ] æ”¯æŒ @ æåŠæ–‡ä»¶/ç¬¦å·
- [ ] æ·»åŠ ä¼šè¯å†å²ç®¡ç†
- [ ] æ·»åŠ å¯¼å‡ºå¯¹è¯åŠŸèƒ½
- [ ] æ”¯æŒå›¾ç‰‡é¢„è§ˆ
- [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ
