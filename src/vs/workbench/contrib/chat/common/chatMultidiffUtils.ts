/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { localize } from '../../../../nls.js';
import { IChatMultiDiffData } from './chatService.js';
import { IChatEditingSession } from './chatEditingService.js';
import { autorun } from '../../../../base/common/observable.js';


export function generateMultidiffFromEditingSession(editingSession: IChatEditingSession): IChatMultiDiffData | undefined {
	const entries = editingSession.entries.get();
	console.log(entries);
	const diffs = editingSession.getDiffsForFilesInSession().read(undefined);
	const test = editingSession.getDiffsForFilesInSession().get();
	console.log(test);
	const test2 = editingSession.getDiffForSession();
	autorun(reader => {
		const test3 = test2.read(reader);
		console.log(test3);
	});
	const resources = diffs.map(entry => {
		return {
			originalUri: entry.originalURI,
			modifiedUri: entry.modifiedURI,
			goToFileUri: entry.modifiedURI,
			added: entry.added,
			removed: entry.removed
		};
	});

	return {
		kind: 'multiDiffData',
		multiDiffData: {
			title: localize('chatMultidiff.autoGenerated', 'Changes to {0} files', diffs.length),
			resources
		}
	};
}
