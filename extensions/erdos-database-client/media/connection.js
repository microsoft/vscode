/*---------------------------------------------------------------------------------------------
 *  Copyright (c) 2025 Lotas Inc. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

(function(){let g=acquireVsCodeApi(),a=document.getElementById("dbType"),v=document.querySelectorAll(".tab-item"),S=document.getElementById("connectionName"),w=document.getElementById("hostGroup"),k=document.getElementById("portGroup"),L=document.getElementById("databaseGroup"),G=document.getElementById("fileGroup"),N=document.getElementById("testConnection"),x=document.getElementById("saveConnection"),T=document.getElementById("toggleAdvanced"),f=document.getElementById("advancedOptions"),p=document.getElementById("useSSH"),P=document.getElementById("sshOptions"),O=document.getElementById("browseFile"),l=document.getElementById("status"),d="MySQL",A={MySQL:{port:3306,showHost:!0,showDatabase:!0,showFile:!1},PostgreSQL:{port:5432,showHost:!0,showDatabase:!0,showFile:!1},SQLite:{port:null,showHost:!1,showDatabase:!0,showFile:!0},Redis:{port:6379,showHost:!0,showDatabase:!0,showFile:!1},MongoDB:{port:27017,showHost:!0,showDatabase:!1,showFile:!1},SqlServer:{port:1433,showHost:!0,showDatabase:!0,showFile:!1},ElasticSearch:{port:9200,showHost:!0,showDatabase:!0,showFile:!1},FTP:{port:21,showHost:!0,showDatabase:!1,showFile:!1},SSH:{port:22,showHost:!0,showDatabase:!0,showFile:!1},Exasol:{port:8563,showHost:!0,showDatabase:!0,showFile:!1}};a&&a.addEventListener("change",U),v.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),R(e.dataset.type)})}),N.addEventListener("click",z),x.addEventListener("click",Q),T.addEventListener("click",W),p.addEventListener("change",j),O.addEventListener("click",V);let C=document.getElementById("useConnectionString");C&&C.addEventListener("change",$);let H=document.getElementById("connectionString");H&&H.addEventListener("input",J),document.querySelectorAll('input[name="esAuth"]').forEach(e=>{e.addEventListener("change",X)});let F=document.getElementById("authType");F&&F.addEventListener("change",Y),document.querySelectorAll('input[name="sshAuthType"]').forEach(e=>{e.addEventListener("change",Z)});let D=document.getElementById("browsePrivateKey");D&&D.addEventListener("click",ee);let q=document.getElementById("useSSL");q&&q.addEventListener("change",_),window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"connectionResult":h(t.message,t.success?"success":"error");break;case"connectionSaved":t.success&&h("Connected successfully!","success");break;case"fileSelected":if(t.fileType==="privateKey"){let n=document.getElementById("privateKeyPath");n&&(n.value=t.path)}else{let n=document.getElementById("filePath");n&&(n.value=t.path)}break}});function R(e){v.forEach(t=>{t.classList.toggle("active",t.dataset.type===e)}),a&&(a.value=e),d=e,U(e)}function U(e){typeof e>"u"&&a?e=a.value:typeof e=="object"&&(e=d);let t=A[e];if(!t)return;let n=document.getElementById("port");t.port&&n&&(n.value=t.port);let c=document.getElementById("hostLabel"),E=document.getElementById("portLabel");c&&(c.style.display=t.showHost?"block":"none"),w&&(w.style.display=t.showHost?"block":"none"),E&&(E.style.display=t.showHost?"block":"none"),k&&(k.style.display=t.showHost?"block":"none");let u=document.getElementById("databaseLabel");u&&(u.style.display=t.showDatabase?"block":"none"),L&&(L.style.display=t.showDatabase?"block":"none");let i=document.getElementById("fileLabel");i&&(i.style.display=t.showFile?"block":"none"),G&&(G.style.display=t.showFile?"block":"none");let b=["srvRecordGroup","useConnectionStringGroup","connectionStringGroup","elasticUrlGroup","esAuthGroup","esUsernameGroup","esPasswordGroup","esTokenGroup","esTimeoutGroup","encodingGroup","showHiddenGroup","instanceNameGroup","authTypeGroup","encryptGroup","domainGroup","sqliteWarning","sqliteFilePathGroup"],I=["srvRecordLabel","useConnectionStringLabel","connectionStringLabel","elasticUrlLabel","esAuthLabel","esUsernameLabel","esPasswordLabel","esTokenLabel","esTimeoutLabel","encodingLabel","showHiddenLabel","instanceNameLabel","authTypeLabel","encryptLabel","domainLabel","sqliteWarningLabel","sqliteFilePathLabel"];switch([...b,...I].forEach(s=>{let o=document.getElementById(s);o&&(o.style.display="none")}),e){case"MongoDB":["srvRecordLabel","srvRecordGroup","useConnectionStringLabel","useConnectionStringGroup"].forEach(s=>{let o=document.getElementById(s);o&&(o.style.display="block")});break;case"ElasticSearch":["elasticUrlLabel","elasticUrlGroup","esAuthLabel","esAuthGroup","esTimeoutLabel","esTimeoutGroup"].forEach(s=>{let o=document.getElementById(s);o&&(o.style.display="block")});break;case"FTP":["encodingLabel","encodingGroup","showHiddenLabel","showHiddenGroup"].forEach(s=>{let o=document.getElementById(s);o&&(o.style.display="block")});break;case"SqlServer":["instanceNameLabel","instanceNameGroup","authTypeLabel","authTypeGroup","encryptLabel","encryptGroup"].forEach(s=>{let o=document.getElementById(s);o&&(o.style.display="block")});break;case"SQLite":["sqliteFilePathLabel","sqliteFilePathGroup"].forEach(s=>{let o=document.getElementById(s);o&&(o.style.display="block")});break}let m=document.getElementById("timezoneLabel"),B=document.getElementById("timezoneGroup");if(m&&B){let s=e==="MySQL";m.style.display=s?"block":"none",B.style.display=s?"block":"none"}let r=document.getElementById("includeDatabasesLabel"),y=document.getElementById("includeDatabasesGroup");if(r&&y){let s=e!=="Redis";r.style.display=s?"block":"none",y.style.display=s?"block":"none"}}function K(){let e={name:S?S.value:"",dbType:d,host:document.getElementById("host")?document.getElementById("host").value:"localhost",port:document.getElementById("port")?parseInt(document.getElementById("port").value):A[d].port,user:document.getElementById("username")?document.getElementById("username").value:"",password:document.getElementById("password")?document.getElementById("password").value:"",database:document.getElementById("database")?document.getElementById("database").value:"",dbPath:document.getElementById("filePath")?document.getElementById("filePath").value:"",useSSL:document.getElementById("useSSL")?document.getElementById("useSSL").checked:!1,usingSSH:document.getElementById("useSSH")?document.getElementById("useSSH").checked:!1,global:document.querySelector('input[name="target"]:checked')?document.querySelector('input[name="target"]:checked').value==="global":!0,connectTimeout:document.getElementById("connectTimeout")&&parseInt(document.getElementById("connectTimeout").value)||5e3,requestTimeout:document.getElementById("requestTimeout")&&parseInt(document.getElementById("requestTimeout").value)||1e4,includeDatabases:document.getElementById("includeDatabases")?document.getElementById("includeDatabases").value:"",timezone:document.getElementById("timezone")?document.getElementById("timezone").value:"+00:00",caPath:document.getElementById("caPath")?document.getElementById("caPath").value:"",clientCertPath:document.getElementById("clientCertPath")?document.getElementById("clientCertPath").value:"",clientKeyPath:document.getElementById("clientKeyPath")?document.getElementById("clientKeyPath").value:"",ssh:p&&p.checked?{host:document.getElementById("sshHost")?document.getElementById("sshHost").value:"",port:document.getElementById("sshPort")&&parseInt(document.getElementById("sshPort").value)||22,username:document.getElementById("sshUser")?document.getElementById("sshUser").value:"",password:document.getElementById("sshPassword")?document.getElementById("sshPassword").value:"",type:document.querySelector('input[name="sshAuthType"]:checked')?document.querySelector('input[name="sshAuthType"]:checked').value:"password",privateKeyPath:document.getElementById("privateKeyPath")?document.getElementById("privateKeyPath").value:"",passphrase:document.getElementById("passphrase")?document.getElementById("passphrase").value:"",cipher:document.getElementById("sshCipher")?document.getElementById("sshCipher").value:"",waitingTime:document.getElementById("waitingTime")&&parseInt(document.getElementById("waitingTime").value)||5e3,algorithms:{cipher:document.getElementById("sshCipher")&&document.getElementById("sshCipher").value?[document.getElementById("sshCipher").value]:[]}}:null};switch(d){case"MongoDB":e.srv=document.getElementById("srvRecord")?document.getElementById("srvRecord").checked:!1,e.useConnectionString=document.getElementById("useConnectionString")?document.getElementById("useConnectionString").checked:!1,e.useConnectionString&&(e.connectionUrl=document.getElementById("connectionString")?document.getElementById("connectionString").value:"");break;case"ElasticSearch":e.esAuth=document.querySelector('input[name="esAuth"]:checked')?document.querySelector('input[name="esAuth"]:checked').value:"none",e.esAuth==="account"?(e.esUsername=document.getElementById("esUsername")?document.getElementById("esUsername").value:"",e.esPassword=document.getElementById("esPassword")?document.getElementById("esPassword").value:""):e.esAuth==="token"&&(e.esToken=document.getElementById("esToken")?document.getElementById("esToken").value:"");let t=document.getElementById("esTimeout");t&&t.value&&(e.connectTimeout=parseInt(t.value)||2e3);break;case"FTP":e.encoding=document.getElementById("encoding")?document.getElementById("encoding").value:"UTF8",e.showHidden=document.getElementById("showHidden")?document.getElementById("showHidden").checked:!1;break;case"SqlServer":e.authType=document.getElementById("authType")?document.getElementById("authType").value:"default",e.encrypt=document.getElementById("encrypt")?document.getElementById("encrypt").checked:!1,e.instanceName=document.getElementById("instanceName")?document.getElementById("instanceName").value:"",e.authType==="ntlm"&&(e.domain=document.getElementById("domain")?document.getElementById("domain").value:"");break;case"SSH":e.showHidden=document.getElementById("showHidden")?document.getElementById("showHidden").checked:!1;break}return e}function z(){let e=K();h("Testing connection...","info"),g.postMessage({type:"testConnection",config:e})}function Q(){let e=K();h("Connecting...","info"),g.postMessage({type:"saveConnection",config:e})}function W(){let e=f.style.display==="none"||!f.style.display;f.style.display=e?"block":"none";let t=T.querySelector(".codicon");t&&(t.className=e?"codicon codicon-chevron-down":"codicon codicon-chevron-right")}function j(){P&&(P.style.display=p.checked?"block":"none")}function V(){g.postMessage({type:"browseFile"})}function h(e,t){l&&(l.textContent=e,l.className=`status-message status-${t}`,l.style.display="block",(t==="success"||t==="error")&&setTimeout(()=>{l.style.display="none"},3e3))}function $(){let e=document.getElementById("connectionStringLabel"),t=document.getElementById("connectionStringGroup"),n=document.getElementById("useConnectionString");if(e&&t&&n){let c=n.checked?"block":"none";e.style.display=c,t.style.display=c}}function J(){let e=document.getElementById("connectionString").value;if(!e)return;let t=/(?<=mongodb\+).+?(?=:\/\/)/,n=e.match(t),c=document.getElementById("srvRecord");n&&c&&(c.checked=!0);let E=/(?<=\/\/).+?(?=\:)/,u=e.match(E),i=document.getElementById("username");u&&i&&(i.value=u[0]);let b=/(?<=\/\/:).+?(?=@)/,I=e.match(b),m=document.getElementById("password");I&&m&&(m.value=I[0]);let B=/(?<=@).+?(?=[:\/])/,r=e.match(B),y=document.getElementById("host");if(r&&y&&(y.value=r[0]),!n){let s=/(?<=\:).\d+/,o=e.match(s),M=document.getElementById("port");o&&M&&(M.value=o[0])}}function X(){let e=document.querySelector('input[name="esAuth"]:checked').value;["esUsernameLabel","esUsernameGroup","esPasswordLabel","esPasswordGroup","esTokenLabel","esTokenGroup"].forEach(t=>{let n=document.getElementById(t);n&&(n.style.display="none")}),e==="account"?["esUsernameLabel","esUsernameGroup","esPasswordLabel","esPasswordGroup"].forEach(t=>{let n=document.getElementById(t);n&&(n.style.display="block")}):e==="token"&&["esTokenLabel","esTokenGroup"].forEach(t=>{let n=document.getElementById(t);n&&(n.style.display="block")})}function Y(){let e=document.getElementById("authType").value,t=document.getElementById("domainLabel"),n=document.getElementById("domainGroup");t&&(t.style.display=e==="ntlm"?"block":"none"),n&&(n.style.display=e==="ntlm"?"block":"none")}function Z(){let e=document.querySelector('input[name="sshAuthType"]:checked').value,t=document.getElementById("sshPasswordAuth"),n=document.getElementById("sshKeyAuth"),c=document.getElementById("sshNativeAuth");t&&(t.style.display=e==="password"?"block":"none"),n&&(n.style.display=e==="privateKey"?"block":"none"),c&&(c.style.display=e==="native"?"block":"none")}function _(){let e=document.getElementById("sslOptions"),t=document.getElementById("useSSL");e&&t&&(e.style.display=t.checked?"block":"none")}function ee(){g.postMessage({type:"browseFile",fileType:"privateKey",filters:{"Private Key":["key","cer","crt","der","pub","pem","pk"],"All Files":["*"]}})}R("MySQL")})();
