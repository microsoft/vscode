/*---------------------------------------------------------------------------------------------
 *  Copyright (c) 2025 Lotas Inc. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

(function(){let u=acquireVsCodeApi(),c={nodes:[],databaseList:{}},n={from:{connection:null,database:null,db:null},to:{connection:null,database:null,db:null}},r={sqlList:null},o=null,g=!1,i=document.getElementById("fromConnection"),L=document.getElementById("fromDatabase"),l=document.getElementById("toConnection"),v=document.getElementById("toDatabase"),f=document.getElementById("compareBtn"),h=document.getElementById("comparisonResults"),m=document.getElementById("syncBtn"),k=document.getElementById("selectAllBtn"),I=document.getElementById("selectNoneBtn"),E=document.getElementById("resultsGrid"),y=document.getElementById("loadingPanel"),B=document.getElementById("errorPanel"),S=document.getElementById("errorText");i.addEventListener("change",q),L.addEventListener("change",e=>C(e.target.value,!0)),l.addEventListener("change",M),v.addEventListener("change",e=>C(e.target.value,!1)),f.addEventListener("click",R),m.addEventListener("click",P),k.addEventListener("click",G),I.addEventListener("click",H),window.addEventListener("message",e=>{let t=e.data;switch(t.type){case"structDiffData":w(t.data);break;case"compareResult":A(t.result);break;case"syncSuccess":V("Sync completed successfully"),p();break;case"error":d(t.message),p();break}});function w(e){c=e,T()}function T(){i.innerHTML='<option value="">Select connection...</option>',l.innerHTML='<option value="">Select connection...</option>',c.nodes.forEach(e=>{let t=document.createElement("option");t.value=e.uid,t.textContent=e.label,i.appendChild(t);let a=document.createElement("option");a.value=e.uid,a.textContent=e.label,l.appendChild(a)})}function q(){n.from.db=null,n.from.database=null,x(i.value,L)}function M(){n.to.db=null,n.to.database=null,x(l.value,v)}function x(e,t){t.innerHTML='<option value="">Select database...</option>',e&&c.databaseList[e]&&c.databaseList[e].forEach(a=>{let s=document.createElement("option");s.value=a.label,s.textContent=a.label,t.appendChild(s)})}function C(e,t){let a=t?n.from.connection:n.to.connection,s=t?i.value:l.value;if(s&&c.databaseList[s]){for(let b of c.databaseList[s])if(b.label===e){t?(n.from.db=b,n.from.database=e,n.from.connection=s):(n.to.db=b,n.to.database=e,n.to.connection=s);break}}}function R(){if(!n.from.connection||!n.from.database||!n.to.connection||!n.to.database){d("Please select both source and target connections and databases");return}D(),O(),u.postMessage({type:"start",option:n})}function A(e){if(r=e,p(),!e.sqlList||e.sqlList.length===0){d("No differences found between the selected schemas");return}N(),h.classList.remove("hidden")}function N(){if(!o&&E&&(o=new DataGrid(E,{sortable:!0,contextMenu:!1,selectable:!0})),o&&r.sqlList){let e=[{field:"type",title:"Type",width:80},{field:"sql",title:"SQL Statement"}],t=r.sqlList.map(a=>({...a,selected:!0}));o.setData(t,e)}}function P(){if(!o){d("No comparison results available");return}let e=o.getSelectedRows();if(!e||e.length===0){d("Need to select at least one SQL statement!");return}D(),u.postMessage({type:"sync",sqlList:e,option:n})}function G(){o&&o.selectAll()}function H(){o&&o.selectNone()}function D(){g=!0,y.classList.remove("hidden"),f.disabled=!0,m.disabled=!0}function p(){g=!1,y.classList.add("hidden"),f.disabled=!1,m.disabled=!1}function d(e){S.textContent=e,B.classList.remove("hidden")}function O(){B.classList.add("hidden")}function V(e){let t=document.createElement("div");t.className="success-notification",t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--vscode-inputValidation-infoBackground);
            color: var(--vscode-inputValidation-infoForeground);
            border: 1px solid var(--vscode-inputValidation-infoBorder);
            padding: 12px 16px;
            border-radius: 4px;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
        `,t.innerHTML=`<i class="codicon codicon-check"></i> ${e}`,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3),h.classList.add("hidden"),r={sqlList:null}}u.postMessage({type:"init"})})();
