/*---------------------------------------------------------------------------------------------
 *  Copyright (c) 2025 Lotas Inc. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

var o=class{constructor(){this.commandHistory=[],this.historyIndex=0,this.content="",this.inputSuggestions=["DEL ","KEYS ","TTL ","PING ","EXISTS ","SET ","SETNX ","GET ","STRLEN ","INCR ","DECR ","HKEYS ","HDEL ","HMSET ","HGETALL ","LPUSH ","LINDEX ","LLEN ","LREM ","RPOP ","LPOP ","LSET ","SADD ","SDIFF ","SMEMBERS ","SPOP ","ZADD ","MULTI ","EXEC "],this.init()}init(){if(this.cliContent=document.getElementById("cliContent"),this.cliInput=document.getElementById("cliInput"),!this.cliContent||!this.cliInput){console.error("Required DOM elements not found");return}this.setupEventListeners(),this.setupVSCodeMessaging(),this.focusInput()}setupEventListeners(){this.cliInput.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),this.executeCommand())}),this.cliInput.addEventListener("keydown",t=>{t.key==="ArrowUp"?(t.preventDefault(),this.navigateHistory(-1)):t.key==="ArrowDown"&&(t.preventDefault(),this.navigateHistory(1))}),this.cliInput.addEventListener("input",t=>{this.handleInputSuggestions(t.target.value)})}setupVSCodeMessaging(){window.addEventListener("message",t=>{let e=t.data;switch(e.type){case"config":this.handleConnected(e.config);break;case"result":this.handleCommandResult("",e.result);break;case"clearTerminal":this.clearTerminal();break;case"exit":this.handleExit();break;case"changeDb":this.handleDbChange(e.database);break;case"removePreTab":break}})}executeCommand(){let t=this.cliInput.value.trim();if(t){if(this.cliInput.value="",this.appendToTerminal(`> ${t}`),this.addToHistory(t),t==="clear"){this.clearTerminal();return}if(t==="exit"||t==="quit"){l.postMessage({type:"ext"});return}l.postMessage({type:"exec",command:t})}}handleConnected(t){this.appendToTerminal(`> ${t.host}@${t.port} connected!`),this.focusInput()}handleCommandResult(t,e){this.appendToTerminal(this.resolveResult(e)),this.scrollToBottom()}handleCommandError(t,e){this.appendToTerminal(`Error: ${e}`),this.scrollToBottom()}handleDbChange(t){this.appendToTerminal(`Switched to database ${t}`),this.scrollToBottom()}handleExit(){this.appendToTerminal("> Connection closed"),this.cliInput.disabled=!0}clearTerminal(){this.content="",this.cliContent.value=""}appendToTerminal(t){this.content+=t+`
`,this.cliContent.value=this.content,this.scrollToBottom()}scrollToBottom(){this.cliContent.scrollTop=this.cliContent.scrollHeight}focusInput(){this.cliInput.focus()}addToHistory(t){!t||!t.length||(this.commandHistory[this.commandHistory.length-1]!==t&&this.commandHistory.push(t),this.historyIndex=this.commandHistory.length)}navigateHistory(t){if(!this.suggesttionShowing()){if(t===-1){if(--this.historyIndex<0&&(this.historyIndex=0),!this.commandHistory[this.historyIndex]){this.cliInput.value="";return}this.cliInput.value=this.commandHistory[this.historyIndex]}else if(t===1){if(++this.historyIndex>this.commandHistory.length&&(this.historyIndex=this.commandHistory.length),!this.commandHistory[this.historyIndex]){this.cliInput.value="";return}this.cliInput.value=this.commandHistory[this.historyIndex]}setTimeout(()=>{this.cliInput.setSelectionRange(this.cliInput.value.length,this.cliInput.value.length)},0)}}handleInputSuggestions(t){if(!t){this.hideSuggestions();return}let e=this.inputSuggestions.filter(s=>s.toLowerCase().indexOf(t.toLowerCase())!==-1);e.length>0?this.showSuggestions([...new Set(e)].map(s=>({value:s}))):this.hideSuggestions()}resolveResult(t){let e="";if(t===null)e=`null
`;else if(typeof t=="object"){let s=!isNaN(t.length);for(let i in t)typeof t[i]=="object"?t[i][0]===null?e+=this.resolveResult(t[i][1]):e+=this.resolveResult(t[i]):e+=`${(s?"":`${i}
`)+t[i]}
`}else e=`${t}
`;return e}showSuggestions(t){let e=document.querySelector(".cli-console-suggestion");e||(e=document.createElement("div"),e.className="cli-console-suggestion",e.style.cssText=`
                position: absolute;
                background: var(--vscode-dropdown-background);
                border: 1px solid var(--vscode-dropdown-border);
                border-radius: 4px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                display: none;
            `,document.body.appendChild(e)),e.innerHTML="",t.forEach(i=>{let n=document.createElement("div");n.textContent=i.value,n.style.cssText=`
                padding: 8px 12px;
                cursor: pointer;
                border-bottom: 1px solid var(--vscode-dropdown-border);
            `,n.addEventListener("click",()=>{this.cliInput.value=i.value,this.hideSuggestions(),this.cliInput.focus()}),e.appendChild(n)});let s=this.cliInput.getBoundingClientRect();e.style.left=s.left+"px",e.style.top=s.bottom+2+"px",e.style.width=s.width+"px",e.style.display="block"}hideSuggestions(){let t=document.querySelector(".cli-console-suggestion");t&&(t.style.display="none")}suggesttionShowing(){let t=document.querySelector(".cli-console-suggestion");return t&&t.style.display!=="none"}},l=acquireVsCodeApi();document.addEventListener("DOMContentLoaded",()=>{new o});
