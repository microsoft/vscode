/*---------------------------------------------------------------------------------------------
 *  Copyright (c) 2025 Lotas Inc. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

(function(){let u=acquireVsCodeApi(),e={result:{data:[],fields:[],dbType:"",costTime:0,sql:"",primaryKey:null,columnList:null,primaryKeyList:null,database:null,table:null,tableCount:null,transId:null},page:{pageNum:1,pageSize:-1,total:null},table:{search:"",loading:!0,widthItem:{}},toolbar:{sql:null,filter:{},showColumns:[]},editDialog:{visible:!1,loading:!1,mode:"insert",originModel:{},editModel:{},columnList:[],primaryKey:null,primaryKeyList:[],dbType:null,database:null,table:null},exportOption:{visible:!1},info:{sql:null,message:null,error:!1,needRefresh:!0},update:{editList:{},lock:!1},remainHeight:0,showFullBtn:!1},o={};document.addEventListener("DOMContentLoaded",function(){F(),V(),S(),u.postMessage({type:"init"})});function F(){o={queryInput:document.getElementById("queryInput"),executeBtn:document.getElementById("executeBtn"),connectionInfo:document.getElementById("connectionInfo"),resultsInfoToolbar:document.getElementById("resultsInfoToolbar"),resultsContent:document.getElementById("resultsContent"),insertBtn:document.getElementById("insertBtn"),deleteBtn:document.getElementById("deleteBtn"),exportBtn:document.getElementById("exportBtn"),searchInput:document.getElementById("searchInput"),breadcrumbPath:document.getElementById("breadcrumbPath"),connectionBreadcrumb:document.getElementById("connectionBreadcrumb"),databaseBreadcrumb:document.getElementById("databaseBreadcrumb"),tableBreadcrumb:document.getElementById("tableBreadcrumb"),connectionName:document.getElementById("connectionName"),databaseName:document.getElementById("databaseName"),tableName:document.getElementById("tableName"),paginationInfo:document.getElementById("paginationInfo"),costTime:document.getElementById("costTime"),dataTable:document.getElementById("dataTable"),messagePanel:document.getElementById("messagePanel"),prevPageBtn:document.getElementById("prevPageBtn"),nextPageBtn:document.getElementById("nextPageBtn"),pageNumSpan:document.getElementById("pageNum"),totalRowsSpan:document.getElementById("totalRows"),columnSelectorDialog:document.getElementById("columnSelectorDialog"),columnCheckboxes:document.getElementById("columnCheckboxes"),selectAllColumnsBtn:document.getElementById("selectAllColumnsBtn"),deselectAllColumnsBtn:document.getElementById("deselectAllColumnsBtn"),closeColumnSelectorBtn:document.getElementById("closeColumnSelectorBtn"),exportDialog:document.getElementById("exportDialog"),exportType:document.getElementById("exportType"),removeLimit:document.getElementById("removeLimit"),confirmExportBtn:document.getElementById("confirmExportBtn"),cancelExportBtn:document.getElementById("cancelExportBtn"),editDialog:document.getElementById("editDialog"),editDialogTitle:document.getElementById("editDialogTitle"),editDialogBody:document.getElementById("editDialogBody"),saveRowBtn:document.getElementById("saveRowBtn"),cancelEditBtn:document.getElementById("cancelEditBtn")}}function V(){o.queryInput&&(o.queryInput.addEventListener("keydown",function(t){t.ctrlKey&&t.key==="Enter"&&(B(),t.preventDefault())}),o.queryInput.addEventListener("input",I),o.queryInput.addEventListener("paste",function(){setTimeout(I,0)}),I()),o.executeBtn&&o.executeBtn.addEventListener("click",B),o.insertBtn&&o.insertBtn.addEventListener("click",function(){_()}),o.deleteBtn&&o.deleteBtn.addEventListener("click",k),o.exportBtn&&o.exportBtn.addEventListener("click",function(){Q()}),o.searchInput&&o.searchInput.addEventListener("input",function(){e.table.search=this.value,G()}),o.prevPageBtn&&o.prevPageBtn.addEventListener("click",function(){D(-1)}),o.nextPageBtn&&o.nextPageBtn.addEventListener("click",function(){D(1)}),o.selectAllColumnsBtn&&o.selectAllColumnsBtn.addEventListener("click",O),o.deselectAllColumnsBtn&&o.deselectAllColumnsBtn.addEventListener("click",P),o.closeColumnSelectorBtn&&o.closeColumnSelectorBtn.addEventListener("click",se),o.confirmExportBtn&&o.confirmExportBtn.addEventListener("click",W),o.cancelExportBtn&&o.cancelExportBtn.addEventListener("click",N),o.saveRowBtn&&o.saveRowBtn.addEventListener("click",ce),o.cancelEditBtn&&o.cancelEditBtn.addEventListener("click",$),window.addEventListener("resize",S),window.addEventListener("keyup",function(t){t.key==="c"&&t.ctrlKey&&document.execCommand("copy")}),window.addEventListener("keypress",function(t){(t.code==="Enter"&&t.target.classList.contains("edit-column")||t.ctrlKey&&t.code==="KeyS")&&(j(),t.stopPropagation(),t.preventDefault())})}function S(){e.remainHeight=window.innerHeight-90,e.showFullBtn=window.outerWidth/window.innerWidth>=2,o.dataTable&&(o.dataTable.style.height=e.remainHeight+"px")}function B(){if(!o.queryInput||!o.queryInput.value.trim())return;let t=o.queryInput.value.trim();e.info.message=!1,e.table.loading=!0,u.postMessage({type:"execute",sql:t}),E(!0)}function D(t,n=null){let l=n||e.page.pageNum+t;u.postMessage({type:"next",sql:e.result.sql,pageNum:l,pageSize:e.page.pageSize}),e.table.loading=!0,E(!0)}function k(){let t=Z();if(!t||t.length===0){d("You need to select at least one row of data.","warning");return}if(confirm("Are you sure you want to delete this data?")){let n=t.filter(i=>i[e.result.primaryKey]!=null).map(i=>f(p(e.result.primaryKey),i[e.result.primaryKey])),l=null;if(e.result.dbType==="ElasticSearch")l=n.length>1?`POST /_bulk
${n.map(i=>`{ "delete" : { "_index" : "${e.result.table}", "_id" : "${i}" } }`).join(`
`)}`:`DELETE /${e.result.table}/_doc/${n[0]}`;else if(e.result.dbType==="MongoDB")l=`db('${e.result.database}').collection("${e.result.table}")
                    .deleteMany({_id:{$in:[${n.join(",")}]}})`;else{let i=R(e.result.table,e.result.dbType);l=n.length>1?`DELETE FROM ${i} WHERE ${e.result.primaryKey} in (${n.join(",")})`:`DELETE FROM ${i} WHERE ${e.result.primaryKey}=${n[0]}`}L(l)}}function L(t){u.postMessage({type:"execute",sql:t}),e.table.loading=!0,E(!0)}function Q(){o.exportType&&(o.exportType.value="xlsx"),o.removeLimit&&(o.removeLimit.checked=!0),o.exportDialog&&(o.exportDialog.style.display="block")}function N(){o.exportDialog&&(o.exportDialog.style.display="none")}function W(){let t=o.exportType?o.exportType.value:"xlsx",n=o.removeLimit?o.removeLimit.checked:!0;o.confirmExportBtn&&(o.confirmExportBtn.textContent="Exporting...",o.confirmExportBtn.disabled=!0),u.postMessage({type:"export",option:{type:t,withOutLimit:n,sql:e.result.sql,table:e.result.table}}),N(),setTimeout(()=>{o.confirmExportBtn&&(o.confirmExportBtn.textContent="Export",o.confirmExportBtn.disabled=!1)},2e3)}function j(){if(Object.keys(e.update.editList).length===0&&e.update.lock)return;e.update.lock=!0;let t="";for(let n in e.update.editList){let l=e.update.editList[n];t+=z(l,e.result.data[n])}t&&u.postMessage({type:"saveModify",sql:t})}function z(t,n){let l=[];for(let s in t)t[s]!==n[s]&&l.push(`${s} = ${f(p(s),t[s])}`);if(l.length===0)return"";let i=R(e.result.table,e.result.dbType),a=f(p(e.result.primaryKey),n[e.result.primaryKey]);return`UPDATE ${i} SET ${l.join(", ")} WHERE ${e.result.primaryKey} = ${a};
`}function y(){if(!o.dataTable||!e.result.data)return;let t=b(),n='<table class="results-table"><thead><tr>';n+=`<th class="index-col">
            <span>#</span>
        </th>`,e.result.fields&&e.result.fields.filter(i=>e.toolbar.showColumns.includes(i.name.toLowerCase())).forEach((i,a)=>{let s=e.editDialog.columnList[a]||i,r=s.nullable!=="YES"?'<span class="required-indicator">*</span>':"",c=De(s);n+=`<th class="sortable column-header" data-field="${i.name}" title="${c}">
                        <div class="column-header-content">
                            ${r}
                            <span class="column-name">${i.name}</span><br>
                            <span class="column-type">${i.type||s.type||""}</span>
                        </div>
                    </th>`}),n+="</tr></thead><tbody>",t.forEach((l,i)=>{l.isFilter||(n+=`<tr data-index="${i}" ondblclick="editRow(${i})">`,n+=`<td class="row-number-cell" onclick="toggleRowSelection(${i})" title="Click to select row">${i+1}</td>`,e.result.fields&&e.result.fields.filter(a=>e.toolbar.showColumns.includes(a.name.toLowerCase())).forEach(a=>{let s=l[a.name],r=e.result.primaryKey&&e.result.tableCount===1,c=Le(s,a,e.result.dbType);n+=`<td class="data-cell ${r?"editable-cell":""}" 
                                     data-field="${a.name}" 
                                     data-row-index="${i}"
                                     ${r?'contenteditable="true"':""}
                                     onblur="${r?"handleCellEdit(this)":""}"
                                     >${c}</td>`}),n+="</tr>")}),n+="</tbody></table>",o.dataTable.innerHTML=n,J(),ie(),g.forEach(l=>{let i=document.querySelector(`tr[data-index="${l}"]`);i&&i.classList.add("selected-row")}),M()}let g=new Set;function J(){document.querySelectorAll(".sortable").forEach(t=>{t.addEventListener("click",function(){let n=this.dataset.field;X(n)})})}function Y(t){let n=document.querySelector(`tr[data-index="${t}"]`);n&&(g.has(t)?(g.delete(t),n.classList.remove("selected-row")):(g.add(t),n.classList.add("selected-row")))}function ke(){g.clear(),document.querySelectorAll(".selected-row").forEach(t=>{t.classList.remove("selected-row")})}function X(t){if(e.result.dbType==="ElasticSearch"){u.postMessage({type:"esSort",sort:[{[t]:{order:"asc"}}]});return}let n=e.result.sql.replace(/\n/," ").replace(";","").replace(/order by .+? (desc|asc)?/gi,"").replace(/\s?(limit.+)?$/i,` ORDER BY ${t} ASC $1 `);L(n+";")}function b(){return e.table.search?e.result.data.filter(t=>!e.table.search||JSON.stringify(t).toLowerCase().includes(e.table.search.toLowerCase())):e.result.data}function G(){y()}function M(){o.pageNumSpan&&(o.pageNumSpan.textContent=e.page.pageNum),o.totalRowsSpan&&e.page.total!==null&&(o.totalRowsSpan.textContent=e.page.total),o.costTime&&(o.costTime.textContent=e.result.costTime+"ms")}function q(){o.connectionName&&e.result.connectionName?o.connectionName.textContent=e.result.connectionName:o.connectionName&&(o.connectionName.textContent="Connection"),o.databaseName&&e.result.database?(o.databaseName.textContent=e.result.database,o.databaseBreadcrumb&&(o.databaseBreadcrumb.style.display="flex")):o.databaseBreadcrumb&&(o.databaseBreadcrumb.style.display="none"),o.tableName&&e.result.table?(o.tableName.textContent=e.result.table,o.tableBreadcrumb&&(o.tableBreadcrumb.style.display="flex")):o.tableBreadcrumb&&(o.tableBreadcrumb.style.display="none"),document.querySelectorAll(".breadcrumb-separator").forEach((n,l)=>{l===0?n.style.display=e.result.database||e.result.table?"inline":"none":l===1&&(n.style.display=e.result.database&&e.result.table?"inline":"none")})}function Z(){let t=[],n=b();return g.forEach(l=>{n[l]&&t.push(n[l])}),t}function E(t){e.table.loading=t,o.dataTable&&o.dataTable.classList.toggle("loading",t)}function d(t,n="info"){o.messagePanel&&(o.messagePanel.innerHTML=`<div class="message ${n}">${t}</div>`,o.messagePanel.style.display="block",setTimeout(()=>{o.messagePanel.style.display="none"},3e3))}function ee(){let t=e.result.fields;if(t){e.toolbar.showColumns=[];for(let n=0;n<t.length;n++)t[n].name&&e.toolbar.showColumns.push(t[n].name.toLowerCase())}}function v(){e.page.pageNum=1,e.page.pageSize=e.result.pageSize,e.page.total=null,e.info.needRefresh?e.info.message=null:e.info.needRefresh=!0,e.table.loading=!1}function te(){v(),e.table.widthItem={},ee(),e.result.columnList&&e.result.data.unshift({isFilter:!0,content:""}),e.result.sql.match(/\bwhere\b/gi)||(e.toolbar.filter={})}function R(t,n){switch(n){case"MySQL":return`\`${t}\``;case"PostgreSQL":return`"${t}"`;case"SQL Server":return`[${t}]`;default:return t}}function ne(t){let n=document.createElement("div");return n.textContent=t,n.innerHTML}window.addEventListener("message",function(t){let n=t.data;if(!n)return;let l=n.content;switch(e.result.transId=l.transId,e.table.loading=!1,n.type){case"EXPORT_DONE":d("Export completed successfully","success");break;case"RUN":o.queryInput&&(o.queryInput.value=l.sql),e.toolbar.sql=l.sql,e.table.loading=l.transId!==e.result.transId;break;case"DATA":le(l);break;case"NEXT_PAGE":e.result.data=l.data,e.result.costTime=l.costTime,e.toolbar.sql=l.sql,e.result.data.unshift({isFilter:!0,content:""}),y();break;case"COUNT":e.page.total=parseInt(l.data),M();break;case"DML":case"DDL":case"MESSAGE_BLOCK":A(l),e.info.error=!1,e.info.needRefresh=!1,(l.message.indexOf("AffectedRows")!==-1||l.isInsert)&&w();break;case"ERROR":A(l),e.info.error=!0;break;case"MESSAGE":l.message&&d(l.message,l.success?"success":"error"),w();break;case"updateSuccess":for(let i in e.update.editList){let a=e.update.editList[i];e.result.data[i]=a}e.update.editList=[],e.update.lock=!1,d("Update Success","success");break;case"connectionUpdated":l.connection&&(e.result.connectionName=l.connection.name,q());break}E(!1)});function le(t){e.result=t,e.toolbar.sql=t.sql,e.result.table===t.table?v():te(),e.result.fields&&e.result.fields.length>0&&(e.toolbar.showColumns=e.result.fields.map(l=>l.name.toLowerCase())),t.total!=null?e.page.total=parseInt(t.total):e.result.tableCount===1&&e.page.pageSize<e.result.data.length+1?oe():e.page.total=e.result.data.length-1,e.update.editList=[],e.update.lock=!1,g.clear(),Ee(),q(),y()}function A(t){if(e.info.message=t.message,o.messagePanel){let n=e.info.error?"error":"success";o.messagePanel.innerHTML=`<div class="message ${n}">${t.message}</div>`,o.messagePanel.style.display="block"}}function w(){e.result.sql&&L(e.result.sql)}function oe(){e.result.table&&(e.info.message=null,u.postMessage({type:"count",sql:e.result.sql}))}function C(){if(!e.result.fields||e.result.fields.length===0){d("No columns available","warning");return}T(),o.columnSelectorDialog&&(o.columnSelectorDialog.style.display="block")}function ie(){let t=document.querySelector(".table-actions-toolbar .toolbar-left");if(t&&!document.getElementById("columnSelectorBtn")){let n=document.createElement("button");n.id="columnSelectorBtn",n.className="btn btn-icon",n.title="Select columns to show",n.innerHTML='<i class="codicon codicon-filter"></i>',n.addEventListener("click",C),t.appendChild(n)}}function T(){!o.columnCheckboxes||!e.result.fields||(o.columnCheckboxes.innerHTML="",e.result.fields.forEach((t,n)=>{let l=document.createElement("div");l.className="checkbox-container";let i=document.createElement("input");i.type="checkbox",i.id=`column_${n}`,i.value=t.name,i.checked=e.toolbar.showColumns.includes(t.name.toLowerCase()),i.addEventListener("change",ae);let a=document.createElement("label");a.htmlFor=`column_${n}`,a.textContent=t.name,l.appendChild(i),l.appendChild(a),o.columnCheckboxes.appendChild(l)}))}function ae(t){let n=t.target.value.toLowerCase(),l=t.target.checked;if(l&&!e.toolbar.showColumns.includes(n))e.toolbar.showColumns.push(n);else if(!l&&e.toolbar.showColumns.includes(n)){let i=e.toolbar.showColumns.indexOf(n);e.toolbar.showColumns.splice(i,1)}y()}function O(){e.result.fields&&(e.toolbar.showColumns=e.result.fields.map(t=>t.name.toLowerCase()),T(),y())}function P(){e.toolbar.showColumns=[],T(),y()}function se(){o.columnSelectorDialog&&(o.columnSelectorDialog.style.display="none")}function K(t){if(!t){d("Edit row cannot be null!","error");return}e.editDialog.originModel=t,e.editDialog.editModel={...t},e.editDialog.mode="update",e.editDialog.loading=!1,e.editDialog.visible=!0,x(),o.editDialog&&(o.editDialog.style.display="block")}function H(t){if(!t){d("Edit row cannot be null!","error");return}e.editDialog.originModel=t,e.editDialog.editModel={...t},e.editDialog.primaryKey&&(e.editDialog.editModel[e.editDialog.primaryKey]=null),e.editDialog.mode="copy",e.editDialog.loading=!1,e.editDialog.visible=!0,x(),o.editDialog&&(o.editDialog.style.display="block")}function _(){if(e.result.tableCount!==1){d("Not table found!","warning");return}e.editDialog.mode="insert",e.editDialog.editModel={},e.editDialog.loading=!1,e.editDialog.visible=!0,x(),o.editDialog&&(o.editDialog.style.display="block")}function $(){e.editDialog.visible=!1,o.editDialog&&(o.editDialog.style.display="none")}function p(t){if(!e.editDialog.columnList)return null;for(let n of e.editDialog.columnList)if(n.name===t)return n.simpleType||n.type;return null}function f(t,n){if(n==null)return"NULL";let l=t?t.toUpperCase():"";return l.includes("INT")||l.includes("DECIMAL")||l.includes("FLOAT")||l.includes("DOUBLE")||l.includes("NUMERIC")||l.includes("NUMBER")?n.toString():l.includes("BOOL")?n?"true":"false":`'${n.toString().replace(/'/g,"''")}'`}function x(){if(!o.editDialogTitle||!o.editDialogBody)return;let t="";if(e.editDialog.mode==="insert")t="Insert To "+(e.editDialog.table||e.result.table);else if(e.editDialog.mode==="update"){let l=e.editDialog.originModel[e.editDialog.primaryKey]||"";t=`Edit For ${e.editDialog.table||e.result.table} : ${e.editDialog.primaryKey}=${l}`}else t="Copy To "+(e.editDialog.table||e.result.table);o.editDialogTitle.textContent=t;let n="";e.editDialog.columnList&&e.editDialog.columnList.length>0&&e.editDialog.columnList.forEach(l=>{let i=e.editDialog.editModel[l.name]||"",a=l.nullable!=="YES"?" *":"",s=l.defaultValue?` Default: ${l.defaultValue}`:"",r=l.extra==="auto_increment"?" AUTO_INCREMENT":"";n+=`
                    <div class="form-group">
                        <label for="edit_${l.name}">
                            ${l.name} : ${l.type}
                            <span style="color: red;">${l.key}${a}</span>
                            <span>${s}${r}</span>
                        </label>
                        ${re(l,i)}
                    </div>
                `}),o.editDialogBody.innerHTML=n,o.saveRowBtn&&(e.editDialog.mode==="update"?o.saveRowBtn.textContent="Update":o.saveRowBtn.textContent="Insert")}function re(t,n){let l=`edit_${t.name}`,i=t.type?t.type.toUpperCase():"";if(i==="DATE")return`<input type="date" id="${l}" class="form-control" value="${n||""}" onchange="updateEditModel('${t.name}', this.value)">`;if(i==="TIME")return`<input type="time" id="${l}" class="form-control" value="${n||""}" onchange="updateEditModel('${t.name}', this.value)">`;if(i==="DATETIME"||i==="TIMESTAMP"||i.includes("TIMESTAMP WITHOUT TIME ZONE")||i.includes("TIMESTAMP WITH TIME ZONE")){let a=n?n.replace(" ","T").substring(0,16):"";return`<input type="datetime-local" id="${l}" class="form-control" value="${a}" onchange="updateEditModel('${t.name}', this.value.replace('T', ' ') + ':00')">`}return`<input type="text" id="${l}" class="form-control" value="${n||""}" onchange="updateEditModel('${t.name}', this.value)">`}function de(t,n){e.editDialog.editModel[t]=n}function ce(){e.editDialog.mode==="update"?me(e.editDialog.editModel,e.editDialog.originModel):ue(e.editDialog.editModel)}function ue(t){if(e.editDialog.dbType==="ElasticSearch"){fe(t);return}else if(e.editDialog.dbType==="MongoDB"){ge(t);return}let n="",l="";for(let i in t){if(p(i)===null)continue;let a=t[i];a!==null&&a!==""&&(n+=`${i},`,l+=`${f(p(i),a)},`)}if(l){let a=`INSERT INTO ${e.editDialog.table||e.result.table}(${n.replace(/,$/,"")}) VALUES(${l.replace(/,$/,"")})`;e.editDialog.loading=!0,executeSQL(a),$()}else d("Not any input, insert fail!","warning")}function me(t,n){let l=pe(t,n);l?(e.editDialog.loading=!0,executeSQL(l),$()):d("Not any change, update fail!","warning")}function pe(t,n){if(e.editDialog.dbType==="ElasticSearch")return ye(t);if(e.editDialog.dbType==="MongoDB")return be(t,n);if(!e.editDialog.primaryKey)return d("This table has not primary key, cannot update!","error"),"";let l="";for(let r in t){if(p(r)===null)continue;let c=n[r],m=t[r];c!==m&&(l+=`${r}=${f(p(r),m)},`)}if(!l)return"";let a=`UPDATE ${e.editDialog.table||e.result.table} SET ${l.replace(/,$/,"")}`,s=e.editDialog.primaryKeyList.length>0?e.editDialog.primaryKeyList:[{name:e.editDialog.primaryKey,type:"VARCHAR"}];for(let r=0;r<s.length;r++){let c=s[r],m=c.name,h=c.simpleType||c.type;r===0?a+=` WHERE ${m}=${f(h,n[m])}`:a+=` AND ${m}=${f(h,n[m])}`}return a+";"}function fe(t){let l=`POST /${e.editDialog.table||e.result.table}/_doc
`+JSON.stringify(t);executeSQL(l)}function ge(t){let n=e.editDialog.database||e.result.database,l=e.editDialog.table||e.result.table,i=`db('${n}').collection("${l}").insertOne(${JSON.stringify(t)})
`;executeSQL(i)}function ye(t){let n={};for(let i in t)i==="_XID"||i==="_index"||i==="_type"||i==="_score"||i==="_id"||(n[i]=t[i]);return`POST /${e.editDialog.table||e.result.table}/_doc/${t._id}
`+JSON.stringify(n)}function be(t,n){let l=Object.assign({},t);delete l._id;let i=n._id.indexOf("ObjectID")!==-1?n._id:`'${n._id}'`,a=e.editDialog.database||e.result.database,s=e.editDialog.table||e.result.table;return`db('${a}').collection("${s}").updateOne({_id:${i}},{ $set:${JSON.stringify(l)}})
`}function Ee(){e.editDialog.columnList=e.result.fields||[],e.editDialog.dbType=e.result.dbType,e.editDialog.database=e.result.database,e.editDialog.table=e.result.table,e.result.primaryKey&&(e.editDialog.primaryKey=e.result.primaryKey),e.result.primaryKeyList&&(e.editDialog.primaryKeyList=e.result.primaryKeyList)}function he(t){let n=U(t);n&&K(n)}function Be(t){let n=U(t);n&&H(n)}function U(t){return b()[t]}function De(t){if(!t)return"";let n=t.name||"";if(t.comment)return t.comment;let l=[];return t.type&&l.push(`Type: ${t.type}`),t.nullable!==void 0&&l.push(t.nullable==="YES"?"Nullable":"Not Null"),t.defaultValue&&l.push(`Default: ${t.defaultValue}`),t.extra==="auto_increment"&&l.push("Auto Increment"),t.key==="PRI"&&l.push("Primary Key"),t.key==="UNI"&&l.push("Unique"),l.length>0?l.join(", "):n}function Le(t,n,l){return t==null?'<span class="null-column">(NULL)</span>':l==="ElasticSearch"?t&&typeof t=="object"&&t.hasOwnProperty("type")?String.fromCharCode.apply(null,new Uint16Array(t.data)):t:t&&typeof t=="object"&&t.hasOwnProperty("type")?String.fromCharCode.apply(null,new Uint16Array(t.data)):ne(t.toString())}function we(t){let n=t.dataset.field,l=parseInt(t.dataset.rowIndex),i=t.textContent,a=b()[l];e.update.editList[l]||(e.update.editList[l]={...a},delete e.update.editList[l]._XID),e.update.editList[l][n]=i,u.postMessage({type:"dataModify"}),t.classList.add("cell-edited"),setTimeout(()=>t.classList.remove("cell-edited"),2e3)}function Ce(t){navigator.clipboard.writeText(t).then(()=>{d("Value copied to clipboard","info")}).catch(()=>{let n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),d("Value copied to clipboard","info")})}function Te(t,n,l){if(e.result.dbType==="ElasticSearch"){let s={};s[t]=n,u.postMessage({type:"esFilter",match:s});return}let i=e.result.sql.replace(/\n/," ").replace(";"," ")+" ",a=new RegExp(`(WHERE|AND)?\\s*\`?${t}\`?\\s*(=|is|>=|<=|<>|LIKE|NOT LIKE)\\s*.+?\\s`,"igm");if(n&&n!=="(NULL)"){let s=n.toLowerCase()==="null"?`${t} is null`:`${$e(t)} ${l} '${n}'`;a.exec(i)?i=i.replace(a,`$1 ${s} `):i.match(/\bwhere\b/gi)?i=i.replace(/\b(where)\b/gi,`$1 ${s} AND `):i=i.replace(new RegExp("(from\\s*.+?)\\s","ig"),`$1 WHERE ${s} `)}executeSQL(i+";")}function $e(t){return e.result.dbType==="MySQL"?`\`${t}\``:t}function I(){if(!o.queryInput)return;let t=o.queryInput,n=window.getComputedStyle(t),l=parseFloat(n.lineHeight)||parseFloat(n.fontSize)*1.2,i=2,a=6;t.style.height="auto";let s=t.scrollHeight,r=parseFloat(n.paddingTop)||0,c=parseFloat(n.paddingBottom)||0,m=parseFloat(n.borderTopWidth)||0,h=parseFloat(n.borderBottomWidth)||0,xe=s-r-c-m-h,Ie=Math.ceil(xe/l),Se=Math.max(i,Math.min(a,Ie))*l+r+c;t.style.height=Se+"px"}window.openColumnSelector=C,window.updateEditModel=de,window.editRow=he,window.copyRow=Be,window.handleCellEdit=we,window.copyCellValue=Ce,window.filterByValue=Te,window.toggleRowSelection=Y,window.resultsApp={state:e,executeQuery:B,refresh:w,changePage:D,deleteSelected:k,openColumnSelector:C,selectAllColumns:O,deselectAllColumns:P,openEdit:K,openInsert:_,openCopy:H}})();
